<div class="container py-4">
  <form (ngSubmit)="onSubmit(formPersona)" #formPersona="ngForm" novalidate class="formulario p-4 rounded-4 shadow-lg">

    <!--  Encabezado -->
    <div class="text-center mb-4">
      <h4 class="text-primary fw-bold mb-1">
        <i class="bi bi-person-lines-fill me-2"></i>
        {{ formModel.idPersona ? 'Editar Persona' : 'Nueva Persona' }}
      </h4>
      <p class="text-muted small">Complete los datos personales y de contacto</p>
    </div>

    <div class="row g-4">
      <!-- Nombre -->
      <div class="col-md-4">
        <label for="nombrePersona" class="form-label">Nombre</label>
        <input
          type="text"
          id="nombrePersona"
          name="nombrePersona"
          class="form-control"
          [(ngModel)]="formModel.nombre"
          required minlength="3"
          placeholder="EJ: Juan Carlos"
        />
        <div *ngIf="formPersona.submitted && !formModel.nombre" class="text-danger small mt-1">
          El nombre es obligatorio
        </div>
      </div>

      <!-- Apellido -->
      <div class="col-md-4">
        <label for="apellidoPersona" class="form-label">Apellido</label>
        <input
          type="text"
          id="apellidoPersona"
          name="apellidoPersona"
          class="form-control"
          [(ngModel)]="formModel.apellido"
          required minlength="3"
          placeholder="EJ: G贸mez"
        />
        <div *ngIf="formPersona.submitted && !formModel.apellido" class="text-danger small mt-1">
          El apellido es obligatorio
        </div>
      </div>

      <!-- Segundo Apellido -->
      <div class="col-md-4">
        <label for="segundoApellido" class="form-label">Segundo Apellido</label>
        <input
          type="text"
          id="segundoApellido"
          name="segundoApellido"
          class="form-control"
          [(ngModel)]="formModel.segundoApellido"
          minlength="3"
          placeholder="EJ: L贸pez"
        />
      </div>

      <!-- Tipo Documento -->
      <div class="col-md-4">
        <label for="tipoDocumento" class="form-label">Tipo de Documento</label>
        <select
          id="tipoDocumento"
          name="tipoDocumento"
          class="form-select"
          [(ngModel)]="formModel.tipoDocumento"
          [compareWith]="compareById"
          required>
          <option [ngValue]="null" disabled>Seleccione tipo de documento</option>
          <option *ngFor="let tipo of tipoDocumentos" [ngValue]="tipo">
            {{ tipo.nombreTipoDocumento }}
          </option>
        </select>
        <div *ngIf="formPersona.submitted && !formModel.tipoDocumento" class="text-danger small mt-1">
          El tipo de documento es obligatorio
        </div>
      </div>

      <!-- Documento -->
      <div class="col-md-4">
        <label for="documentoPersona" class="form-label">N掳 Documento</label>
        <input
          type="text"
          id="documentoPersona"
          name="documentoPersona"
          class="form-control"
          [(ngModel)]="formModel.documentoPersona"
          required minlength="3"
          placeholder="EJ: 1115078546"
        />
        <div *ngIf="formPersona.submitted && !formModel.documentoPersona" class="text-danger small mt-1">
          El n煤mero de documento es obligatorio
        </div>
      </div>

      <!-- Tel茅fono -->
      <div class="col-md-4">
        <label for="telefono" class="form-label">Tel茅fono</label>
        <input
          type="text"
          id="telefono"
          name="telefono"
          class="form-control"
          [(ngModel)]="formModel.telefono"
          required minlength="3"
          placeholder="EJ: 3002543214"
        />
        <div *ngIf="formPersona.submitted && !formModel.telefono" class="text-danger small mt-1">
          El tel茅fono es obligatorio
        </div>
      </div>

      <!-- Direcci贸n -->
      <div class="col-md-6">
        <label for="direccion" class="form-label">Direcci贸n</label>
        <input
          type="text"
          id="direccion"
          name="direccion"
          class="form-control"
          [(ngModel)]="formModel.direccion"
          required minlength="3"
          placeholder="EJ: Calle 4 # 13 - 23"
        />
        <div *ngIf="formPersona.submitted && !formModel.direccion" class="text-danger small mt-1">
          La direcci贸n es obligatoria
        </div>
      </div>

      <!-- Email -->
      <div class="col-md-6">
        <label for="email" class="form-label">Email</label>
        <input
          type="email"
          id="email"
          name="email"
          class="form-control"
          [(ngModel)]="formModel.email"
          required
          placeholder="EJ: juango23@hotmail.com"
        />
        <div *ngIf="formPersona.submitted && !formModel.email" class="text-danger small mt-1">
          El email es obligatorio
        </div>
      </div>

      <!-- Ciudad -->
      <div class="col-md-6">
        <label for="ciudad" class="form-label">Ciudad</label>
        <select
          id="ciudad"
          name="ciudad"
          class="form-select"
          [(ngModel)]="formModel.ciudad"
          [compareWith]="compareById"
          required>
          <option [ngValue]="null" disabled>Seleccione ciudad</option>
          <option *ngFor="let city of ciudades" [ngValue]="city">
            {{ city.ciudad }}
          </option>
        </select>
        <div *ngIf="formPersona.submitted && !formModel.ciudad" class="text-danger small mt-1">
          La ciudad es obligatoria
        </div>
      </div>

      <!-- Tipo Persona -->
      <div class="col-md-6">
        <label for="tipoPersona" class="form-label">Tipo de Persona</label>
        <select
          id="tipoPersona"
          name="tipoPersona"
          class="form-select"
          [(ngModel)]="formModel.tipoPersona"
          [compareWith]="compareById"
          required>
          <option [ngValue]="null" disabled>Seleccione tipo de persona</option>
          <option *ngFor="let tipoPersona of tipoPersonas" [ngValue]="tipoPersona">
            {{ tipoPersona.nombreTipoPersona }}
          </option>
        </select>
        <div *ngIf="formPersona.submitted && !formModel.tipoPersona" class="text-danger small mt-1">
          El tipo de persona es obligatorio
        </div>
      </div>
      <!-- Roles -->
      <div class="col-md-6">
        <label for="roles" class="form-label">Roles</label>
        <div *ngFor="let rol of listaRoles" class="form-check">
    <input
      type="checkbox"
      class="form-check-input"
      [id]="'rol-' + rol.idRolPersona"
      [value]="rol.idRolPersona"
      [checked]="formModel.idsRoles?.includes(rol.idRolPersona)"
      (change)="onRolChange($event, rol.idRolPersona)"
    />
    <label class="form-check-label" [for]="'rol-' + rol.idRolPersona">
      {{ rol.nombreRol }}
    </label>
  </div>
        <div *ngIf="formPersona.submitted && !formModel.tipoPersona" class="text-danger small mt-1">
          El rol es obligatorio
        </div>
      </div>
    </div>

    <!-- Botones -->
    <div class="d-flex justify-content-end mt-4">
      <button type="button" class="btn btn-outline-light me-2" data-bs-dismiss="modal">Cancelar</button>
      <button type="submit" class="btn btn-gradient" [disabled]="formPersona.invalid">
        <i class="bi bi-save2 me-1"></i>
        {{ formModel.idPersona ? 'Guardar cambios' : 'Agregar persona' }}
      </button>
    </div>
  </form>
</div>
